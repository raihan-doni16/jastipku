import{f,a as m}from"../chunks/CUf5UZYF.js";import"../chunks/BoQy5TvO.js";import{o as me}from"../chunks/JjBbrouE.js";import{a6 as fe,a7 as R,a8 as be,a9 as Y,i as e,ab as he,z as P,ac as i,k as C,a4 as s,a5 as r,u as v,aa as g,a2 as Z}from"../chunks/C6kp5iGx.js";import{s as u,e as $}from"../chunks/Dvw9CKj1.js";import{i as y}from"../chunks/BMTi0gWB.js";import{b as ge,e as ee}from"../chunks/DPurX8ys.js";import{r as xe}from"../chunks/CK8WfoRq.js";import{s as ae}from"../chunks/D6eV9jrv.js";import{b as Ce}from"../chunks/BXzdIX3i.js";import{i as ye}from"../chunks/BvILkHPm.js";import{g as ke}from"../chunks/BqC4448f.js";import{N as De}from"../chunks/CAlpgxxh.js";import{c as te}from"../chunks/tGRDOfAf.js";var Ne=f('<span class="unread-badge svelte-18uwwr5"> </span>'),Le=f('<div class="chat-order-code svelte-18uwwr5"> </div>'),Pe=f('<span class="unread-count svelte-18uwwr5"> </span>'),Te=f('<button><div class="chat-avatar svelte-18uwwr5"> </div> <div class="chat-info svelte-18uwwr5"><div class="chat-name-row svelte-18uwwr5"><span class="chat-name svelte-18uwwr5"> </span> <span class="chat-time svelte-18uwwr5"> </span></div> <div class="chat-last-message svelte-18uwwr5"> </div> <!></div> <!></button>'),je=f('<div class="empty-chat-list svelte-18uwwr5"><div class="empty-icon">ğŸ’¬</div> <p>Tidak ada percakapan ditemukan</p></div>'),Ie=f('<div class="chat-detail-order svelte-18uwwr5"> </div>'),Me=f('<div><div class="message-bubble svelte-18uwwr5"><p class="message-text svelte-18uwwr5"> </p> <span class="message-time svelte-18uwwr5"> </span></div></div>'),Se=f('<div class="chat-detail-header svelte-18uwwr5"><button class="back-button svelte-18uwwr5">â†</button> <div class="chat-detail-avatar svelte-18uwwr5"> </div> <div class="chat-detail-info svelte-18uwwr5"><div class="chat-detail-name svelte-18uwwr5"> </div> <!></div> <button class="more-button svelte-18uwwr5">â‹®</button></div> <div class="messages-container svelte-18uwwr5"></div> <div class="message-input svelte-18uwwr5"><button class="attach-button svelte-18uwwr5" type="button">ğŸ“</button> <input type="text" placeholder="Ketik balasan..." class="svelte-18uwwr5"/> <button class="send-button svelte-18uwwr5" type="button">ğŸ“¤</button></div>',1),Ae=f('<div class="no-chat-selected svelte-18uwwr5"><div class="no-chat-icon svelte-18uwwr5">ğŸ’¬</div> <h3>Pilih Chat</h3> <p>Pilih percakapan dari daftar untuk melihat pesan</p></div>'),Je=f('<!> <div class="container svelte-18uwwr5"><div class="chat-layout svelte-18uwwr5"><div class="chat-list svelte-18uwwr5"><div class="chat-list-header svelte-18uwwr5"><h2 class="svelte-18uwwr5">Pesan Pembeli</h2> <!></div> <div class="search-box svelte-18uwwr5"><span class="search-icon">ğŸ”</span> <input type="text" placeholder="Cari pembeli atau order..." class="svelte-18uwwr5"/></div> <div class="chat-items svelte-18uwwr5"></div> <!></div> <div class="chat-detail svelte-18uwwr5"><!></div></div></div>',1);function Xe(re,se){fe(se,!1);const k=P(),T=P(),J=P();let U="guest";ge.subscribe(t=>{U=t.role}),me(()=>{U!=="jastiper"&&ke("/login?redirect=/jastiper/chats&expected=jastiper")});const ie="JST001";let l=P(null),j=P("");function ve(t){C(l,t),t.unreadCount=0}function B(t){const a=new Date(t);if(Number.isNaN(a.getTime()))return t;const _=new Date-a,d=Math.floor(_/(1e3*60*60*24));return d===0?a.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}):d===1?"Kemarin":d<7?a.toLocaleDateString("id-ID",{weekday:"long"}):a.toLocaleDateString("id-ID",{day:"numeric",month:"short"})}function oe(){C(l,null)}R(()=>te,()=>{C(k,te.filter(t=>t.jastiperId===ie))}),R(()=>(e(k),e(j)),()=>{C(T,e(k).filter(t=>{var o,_,d;const a=e(j).trim().toLowerCase();return a?((o=t.buyerName)==null?void 0:o.toLowerCase().includes(a))||((_=t.orderCode)==null?void 0:_.toLowerCase().includes(a))||((d=t.lastMessage)==null?void 0:d.toLowerCase().includes(a)):!0}))}),R(()=>e(k),()=>{C(J,e(k).reduce((t,a)=>t+(a.unreadCount||0),0))}),be(),ye();var E=Je(),F=Y(E);De(F,{});var G=i(F,2),V=s(G),K=s(V),O=s(K),le=i(s(O),2);{var de=t=>{var a=Ne(),o=s(a,!0);r(a),g(()=>u(o,e(J))),m(t,a)};y(le,t=>{e(J)>0&&t(de)})}r(O);var q=i(O,2),W=i(s(q),2);xe(W),r(q);var z=i(q,2);ee(z,5,()=>e(T),t=>t.id,(t,a)=>{var o=Te();let _;var d=s(o),H=s(d,!0);r(d);var x=i(d,2),h=s(x),D=s(h),Q=s(D,!0);r(D);var I=i(D,2),M=s(I,!0);r(I),r(h);var c=i(h,2),w=s(c,!0);r(c);var b=i(c,2);{var S=p=>{var n=Le(),L=s(n);r(n),g(()=>u(L,`Order: ${e(a),v(()=>e(a).orderCode)??""}`)),m(p,n)};y(b,p=>{e(a),v(()=>e(a).orderCode)&&p(S)})}r(x);var A=i(x,2);{var N=p=>{var n=Pe(),L=s(n,!0);r(n),g(()=>u(L,(e(a),v(()=>e(a).unreadCount)))),m(p,n)};y(A,p=>{e(a),v(()=>e(a).unreadCount>0)&&p(N)})}r(o),g(p=>{var n;_=ae(o,1,"chat-item svelte-18uwwr5",null,_,{active:((n=e(l))==null?void 0:n.id)===e(a).id,unread:e(a).unreadCount>0}),u(H,(e(a),v(()=>e(a).buyerAvatar??"ğŸ›’"))),u(Q,(e(a),v(()=>e(a).buyerName??"Pembeli"))),u(M,p),u(w,(e(a),v(()=>e(a).lastMessage)))},[()=>(e(a),v(()=>B(e(a).lastMessageTime)))]),$("click",o,()=>ve(e(a))),m(t,o)}),r(z);var ne=i(z,2);{var ue=t=>{var a=je();m(t,a)};y(ne,t=>{e(T),v(()=>e(T).length===0)&&t(ue)})}r(K);var X=i(K,2),ce=s(X);{var we=t=>{var a=Se(),o=Y(a),_=s(o),d=i(_,2),H=s(d,!0);r(d);var x=i(d,2),h=s(x),D=s(h,!0);r(h);var Q=i(h,2);{var I=c=>{var w=Ie(),b=s(w);r(w),g(()=>u(b,`Order: ${e(l),v(()=>e(l).orderCode)??""}`)),m(c,w)};y(Q,c=>{e(l),v(()=>e(l).orderCode)&&c(I)})}r(x),Z(2),r(o);var M=i(o,2);ee(M,5,()=>(e(l),v(()=>e(l).messages)),c=>c.id,(c,w)=>{var b=Me();let S;var A=s(b),N=s(A),p=s(N,!0);r(N);var n=i(N,2),L=s(n,!0);r(n),r(A),r(b),g(_e=>{S=ae(b,1,"message svelte-18uwwr5",null,S,{own:e(w).sender==="jastiper"}),u(p,(e(w),v(()=>e(w).text))),u(L,_e)},[()=>(e(w),v(()=>B(e(w).timestamp)))]),m(c,b)}),r(M),Z(2),g(()=>{u(H,(e(l),v(()=>e(l).buyerAvatar??"ğŸ›ï¸"))),u(D,(e(l),v(()=>e(l).buyerName??"Pembeli")))}),$("click",_,oe),m(t,a)},pe=t=>{var a=Ae();m(t,a)};y(ce,t=>{e(l)?t(we):t(pe,!1)})}r(X),r(V),r(G),Ce(W,()=>e(j),t=>C(j,t)),m(re,E),he()}export{Xe as component};
